# Продвинутое руководство

## Переменные

Если вы хотите, чтобы игра запоминала каждый выбор игрока, то без переменных нам не обойтись.

Объявление переменных происходит в специальном блоке init. Имена и значения у переменных могут быть любые, но рекомендуется использовать короткие английские слова или цифры (цифры только в значении).

```renpy
init:
    $ choice = False # Переменная будет объявлена со значением False
    $ count = 0 # А у этой переменной будет значение 0
```

Изменение значения переменных будет выглядеть так:

```renpy{6-7}
init:
    $ choice = False # Переменная будет объявлена со значением False
    $ count = 0 # А у этой переменной будет значение 0

label my_mod:
    $ choice = True
    $ count += 1
```

## Выборы

Если вы хотите дать игроку выбор, то вам необходимо использовать специальный блок menu:

```renpy
mt "Возьми-ка этот мешок с сахаром."

menu:
    "И куда мне его девать?":
        $ good += 1
        jump good_label
    "Да идите вы со своим сахаром на ...":
        jump bad_label
```

В приведенном примере Ольга Дмитриевна попросит нас взять мешок с сахаром, мы же можем как подчиниться и увеличить переменную "good" на 1, так и отказаться, причем в зависимости от нашего выбора события в игре могут измениться.

::: danger Будьте осторожны
Варианты ответа тоже открывают блок, и если мы не поставим после каждого двоеточие, мод может не запуститься.
:::

## Проверка условий

Что нам делать если мы хотим чтобы какие то из возможностей были у игрока в зависимости от его выборов? Для этого то мы и использовали переменные! Сейчас же мы воспользуемся специальной конструкцией:

```renpy
label my_mod:
    if good > 0:
        jump good_end
    else:
        jump bad_end
```

Если значение переменной `good` больше нуля, то игра продолжится на метке `good_end`, если же нет, то мы переходим на метку `bad_end`.

Теперь же мы постараемся реализовать выборы, в которых в зависимости от прошлых выборов персонажа будут добавляться или убираться различные варианты ответов:

```renpy
label my_mod:
    mt "Семен, сегодня после обеда ты будешь убираться в столовой."

    menu:
        "Почему именно я?":
            jump why_me
        "Я же уже помог вам сегодня" if good > 0:
            jump helped_today
        "Не намерен я вам тут прислуживать!" if good == 0:
            jump angry
```

В данном случае мы можем либо возмущаться сложившейся ситуации, если мы уже заслужили доверие вожатой, мы можем попросить ее отсрочить дежурство или если не помогали отправить ее куда подальше. И в каждом случае нам, как создателям мода необходимо будет прописать что произойдет в каждом из этих случаев.

## Использование карты

Чтобы дать игре понять, когда развернуть перед игроком карту необходимо всего несколько простых команд.

1. Перед выводом карты нужно сбросить все прошлые зоны на ней:

```renpy
$ disable_all_zones() # Отключает все старые маркеры карты.
```

2. Заполняем конструкцию `set_zone()`.

Первым значением будет выделенная на карте зона, а вторым - лейбл, куда прыгать, при клике на неё.

Вот список всех зон и как они обозначены в игре:

- `me_mt_house` - Домик Семёна и Ольги Дмитриевны
- `estrade` - Сцена
- `music_club` - Музклуб
- `square` - Площадь
- `dining_hall` - Столовая
- `sport_area` - Спорткомплекс
- `beach` - Пляж
- `boat_station` - Лодочный причал
- `clubs` - Клубы
- `library` - Библиотека
- `medic_house` - Медпункт
- `camp_entrance` - Ворота в лагерь
- `forest` - Лес

Например, чтобы при нажатии на клубы мы прыгали на лейбл `day1_gone_to_clubs` (название, лишь для примера) нужно реализовать такую конструкцию:

```renpy
$ set_zone("clubs", "day1_gone_to_clubs")
```

И в конце, выводим саму карту командой:

```renpy{2}
$ set_zone("clubs", "day1_gone_to_clubs")
$ show_map()
```

Полный пример:

```renpy
label my_mod:
    $ disable_all_zones()

    $ set_zone("me_mt_house", "day1_gone_to_mt_house") # Домик Семёна и Ольги Дмитриевны
    $ set_zone("estrade", "day1_gone_to_estrade") # Сцена
    $ set_zone("music_club", "day1_gone_to_music_club") # Музклуб
    $ set_zone("square", "day1_gone_to_square") # Площадь
    $ set_zone("dining_hall", "day1_gone_to_dining_hall") # Столовая
    $ set_zone("sport_area", "day1_gone_to_sport_area") # Спорткомплекс
    $ set_zone("beach", "day1_gone_to_beach") # Пляж
    $ set_zone("boat_station", "day1_gone_to_boat_station") # Лодочный причал
    $ set_zone("clubs", "day1_gone_to_clubs") # Клубы
    $ set_zone("library", "day1_gone_to_library") # Библиотека
    $ set_zone("medic_house", "day1_gone_to_medic_house") # Медпункт
    $ set_zone("camp_entrance", "day1_gone_to_camp_entrance") # Ворота в лагерь
    $ set_zone("forest", "day1_gone_to_forest") # Лес

    $ show_map()
```

## Добавление персонажа

Любой персонаж игры - простая переменная. Переменные создаются двумя способами, методом движка - с помощью команды `define` и методом Python - с помощью символа - `$`.

```renpy
define ivan = Character(u"Иван")
```

::: tip
Символ `u` используется, для отображения русского текста у людей, у которых он не установлен в системе.
:::

Теперь персонажа можно использовать в моде:

```renpy{3-4}
define ivan = Character(u"Иван")

label my_mod:
    ivan "Привет"
```

Цвет имени персонажа указывается с помощью параметра `color`, так-же рекомендую использовать неизменный параметр `what_color`, для изменения цвета речи персонажа. В самой игре, все персонажи говорят цветом `#f1d076`, так не будем выделяться. Назначим нашему персонажу в качестве цвета имени, скажем, зелёный цвет (`#008000`) и установим в качестве цвета речи - `#f1d076`:

```renpy{1}
define ivan = Character(u"Иван", color="#008000", what_color="#f1d076")

label my_mod:
    ivan "Привет"
```

## Монитор с номером дня

Для выведения на экран монитора, необходимо прописать две команды:

```renpy
$ backdrop = "days"
$ new_chapter(1, u"Мой мод. День первый.")
```

где:

- `backdrop` - фон с монитором.
- `1` - номер дня, который будет показан на мониторе.
- текст (в примере - **Мой мод. День первый.**) - то, как будет называться сохранение.

Фонов (`backdrop`) в игре 5:

```renpy
$ backdrop = "days" # Просто монитор.
$ backdrop = "un" # Монитор с проплывающей Леной.
$ backdrop = "us" # Монитор с проплывающей Ульяной.
$ backdrop = "sl" # Монитор с проплывающей Славей.
$ backdrop = "dv" # Монитор с проплывающей Алисой.
```

## Достижения

Для вывода достижения в нужном вам месте вставьте следующие команды:

```renpy
label my_mod:
    play sound sfx_achievement
    show myachiv at achievement_trans
    with dspr
    $ renpy.pause(3, hard=True)
    hide myachiv
```

где:

- `myachiv` - Ваша картинка с достижением.
